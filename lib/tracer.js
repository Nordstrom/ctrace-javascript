'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var cov_cnb1eitlw = function () {
  var path = '/Users/x1vz/nord-repos/ctrace-js/src/tracer.js',
      hash = '1791ff79af4fdf10a4590ac1403b270822f747af',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/x1vz/nord-repos/ctrace-js/src/tracer.js',
    statementMap: {
      '0': {
        start: {
          line: 8,
          column: 12
        },
        end: {
          line: 8,
          column: 14
        }
      },
      '1': {
        start: {
          line: 9,
          column: 0
        },
        end: {
          line: 11,
          column: 1
        }
      },
      '2': {
        start: {
          line: 10,
          column: 2
        },
        end: {
          line: 10,
          column: 45
        }
      },
      '3': {
        start: {
          line: 14,
          column: 14
        },
        end: {
          line: 14,
          column: 19
        }
      },
      '4': {
        start: {
          line: 15,
          column: 10
        },
        end: {
          line: 15,
          column: 11
        }
      },
      '5': {
        start: {
          line: 16,
          column: 2
        },
        end: {
          line: 19,
          column: 33
        }
      },
      '6': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 36,
          column: 78
        }
      },
      '7': {
        start: {
          line: 37,
          column: 4
        },
        end: {
          line: 37,
          column: 49
        }
      },
      '8': {
        start: {
          line: 38,
          column: 4
        },
        end: {
          line: 38,
          column: 78
        }
      },
      '9': {
        start: {
          line: 39,
          column: 4
        },
        end: {
          line: 39,
          column: 26
        }
      },
      '10': {
        start: {
          line: 40,
          column: 4
        },
        end: {
          line: 40,
          column: 30
        }
      },
      '11': {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 46,
          column: 5
        }
      },
      '12': {
        start: {
          line: 43,
          column: 6
        },
        end: {
          line: 43,
          column: 54
        }
      },
      '13': {
        start: {
          line: 44,
          column: 6
        },
        end: {
          line: 44,
          column: 76
        }
      },
      '14': {
        start: {
          line: 45,
          column: 6
        },
        end: {
          line: 45,
          column: 48
        }
      },
      '15': {
        start: {
          line: 48,
          column: 4
        },
        end: {
          line: 51,
          column: 5
        }
      },
      '16': {
        start: {
          line: 49,
          column: 6
        },
        end: {
          line: 49,
          column: 69
        }
      },
      '17': {
        start: {
          line: 50,
          column: 6
        },
        end: {
          line: 50,
          column: 65
        }
      },
      '18': {
        start: {
          line: 53,
          column: 18
        },
        end: {
          line: 53,
          column: 37
        }
      },
      '19': {
        start: {
          line: 54,
          column: 4
        },
        end: {
          line: 59,
          column: 5
        }
      },
      '20': {
        start: {
          line: 55,
          column: 6
        },
        end: {
          line: 58,
          column: 7
        }
      },
      '21': {
        start: {
          line: 56,
          column: 19
        },
        end: {
          line: 56,
          column: 41
        }
      },
      '22': {
        start: {
          line: 57,
          column: 8
        },
        end: {
          line: 57,
          column: 64
        }
      },
      '23': {
        start: {
          line: 92,
          column: 16
        },
        end: {
          line: 92,
          column: 33
        }
      },
      '24': {
        start: {
          line: 93,
          column: 14
        },
        end: {
          line: 93,
          column: 77
        }
      },
      '25': {
        start: {
          line: 95,
          column: 19
        },
        end: {
          line: 95,
          column: 26
        }
      },
      '26': {
        start: {
          line: 97,
          column: 18
        },
        end: {
          line: 97,
          column: 24
        }
      },
      '27': {
        start: {
          line: 101,
          column: 4
        },
        end: {
          line: 104,
          column: 5
        }
      },
      '28': {
        start: {
          line: 102,
          column: 6
        },
        end: {
          line: 102,
          column: 27
        }
      },
      '29': {
        start: {
          line: 103,
          column: 6
        },
        end: {
          line: 103,
          column: 27
        }
      },
      '30': {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 108,
          column: 5
        }
      },
      '31': {
        start: {
          line: 107,
          column: 6
        },
        end: {
          line: 107,
          column: 27
        }
      },
      '32': {
        start: {
          line: 112,
          column: 4
        },
        end: {
          line: 127,
          column: 5
        }
      },
      '33': {
        start: {
          line: 113,
          column: 6
        },
        end: {
          line: 119,
          column: 7
        }
      },
      '34': {
        start: {
          line: 121,
          column: 6
        },
        end: {
          line: 126,
          column: 7
        }
      },
      '35': {
        start: {
          line: 129,
          column: 4
        },
        end: {
          line: 129,
          column: 36
        }
      },
      '36': {
        start: {
          line: 130,
          column: 4
        },
        end: {
          line: 130,
          column: 22
        }
      },
      '37': {
        start: {
          line: 131,
          column: 4
        },
        end: {
          line: 131,
          column: 17
        }
      },
      '38': {
        start: {
          line: 133,
          column: 4
        },
        end: {
          line: 135,
          column: 5
        }
      },
      '39': {
        start: {
          line: 134,
          column: 6
        },
        end: {
          line: 134,
          column: 27
        }
      },
      '40': {
        start: {
          line: 137,
          column: 4
        },
        end: {
          line: 139,
          column: 5
        }
      },
      '41': {
        start: {
          line: 138,
          column: 6
        },
        end: {
          line: 138,
          column: 25
        }
      },
      '42': {
        start: {
          line: 141,
          column: 4
        },
        end: {
          line: 144,
          column: 6
        }
      },
      '43': {
        start: {
          line: 146,
          column: 4
        },
        end: {
          line: 148,
          column: 5
        }
      },
      '44': {
        start: {
          line: 147,
          column: 6
        },
        end: {
          line: 147,
          column: 30
        }
      },
      '45': {
        start: {
          line: 149,
          column: 4
        },
        end: {
          line: 149,
          column: 28
        }
      },
      '46': {
        start: {
          line: 182,
          column: 24
        },
        end: {
          line: 182,
          column: 49
        }
      },
      '47': {
        start: {
          line: 183,
          column: 4
        },
        end: {
          line: 185,
          column: 5
        }
      },
      '48': {
        start: {
          line: 184,
          column: 6
        },
        end: {
          line: 184,
          column: 54
        }
      },
      '49': {
        start: {
          line: 210,
          column: 24
        },
        end: {
          line: 210,
          column: 49
        }
      },
      '50': {
        start: {
          line: 211,
          column: 4
        },
        end: {
          line: 214,
          column: 5
        }
      },
      '51': {
        start: {
          line: 212,
          column: 16
        },
        end: {
          line: 212,
          column: 53
        }
      },
      '52': {
        start: {
          line: 213,
          column: 6
        },
        end: {
          line: 213,
          column: 25
        }
      },
      '53': {
        start: {
          line: 213,
          column: 15
        },
        end: {
          line: 213,
          column: 25
        }
      },
      '54': {
        start: {
          line: 215,
          column: 4
        },
        end: {
          line: 215,
          column: 20
        }
      },
      '55': {
        start: {
          line: 220,
          column: 4
        },
        end: {
          line: 222,
          column: 5
        }
      },
      '56': {
        start: {
          line: 221,
          column: 6
        },
        end: {
          line: 221,
          column: 12
        }
      },
      '57': {
        start: {
          line: 223,
          column: 4
        },
        end: {
          line: 223,
          column: 40
        }
      },
      '58': {
        start: {
          line: 227,
          column: 16
        },
        end: {
          line: 227,
          column: 21
        }
      },
      '59': {
        start: {
          line: 228,
          column: 12
        },
        end: {
          line: 228,
          column: 13
        }
      },
      '60': {
        start: {
          line: 229,
          column: 4
        },
        end: {
          line: 232,
          column: 35
        }
      }
    },
    fnMap: {
      '0': {
        name: 'genId',
        decl: {
          start: {
            line: 13,
            column: 9
          },
          end: {
            line: 13,
            column: 14
          }
        },
        loc: {
          start: {
            line: 13,
            column: 18
          },
          end: {
            line: 20,
            column: 1
          }
        },
        line: 13
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 35,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        loc: {
          start: {
            line: 35,
            column: 29
          },
          end: {
            line: 60,
            column: 3
          }
        },
        line: 35
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 91,
            column: 2
          },
          end: {
            line: 91,
            column: 3
          }
        },
        loc: {
          start: {
            line: 91,
            column: 33
          },
          end: {
            line: 150,
            column: 3
          }
        },
        line: 91
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 181,
            column: 2
          },
          end: {
            line: 181,
            column: 3
          }
        },
        loc: {
          start: {
            line: 181,
            column: 40
          },
          end: {
            line: 186,
            column: 3
          }
        },
        line: 181
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 209,
            column: 2
          },
          end: {
            line: 209,
            column: 3
          }
        },
        loc: {
          start: {
            line: 209,
            column: 28
          },
          end: {
            line: 216,
            column: 3
          }
        },
        line: 209
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 218,
            column: 2
          },
          end: {
            line: 218,
            column: 3
          }
        },
        loc: {
          start: {
            line: 218,
            column: 18
          },
          end: {
            line: 224,
            column: 3
          }
        },
        line: 218
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 226,
            column: 2
          },
          end: {
            line: 226,
            column: 3
          }
        },
        loc: {
          start: {
            line: 226,
            column: 18
          },
          end: {
            line: 233,
            column: 3
          }
        },
        line: 226
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 35,
            column: 15
          },
          end: {
            line: 35,
            column: 27
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 35,
            column: 25
          },
          end: {
            line: 35,
            column: 27
          }
        }],
        line: 35
      },
      '1': {
        loc: {
          start: {
            line: 36,
            column: 21
          },
          end: {
            line: 36,
            column: 78
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 36,
            column: 21
          },
          end: {
            line: 36,
            column: 37
          }
        }, {
          start: {
            line: 36,
            column: 41
          },
          end: {
            line: 36,
            column: 78
          }
        }],
        line: 36
      },
      '2': {
        loc: {
          start: {
            line: 37,
            column: 22
          },
          end: {
            line: 37,
            column: 49
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 37,
            column: 22
          },
          end: {
            line: 37,
            column: 40
          }
        }, {
          start: {
            line: 37,
            column: 44
          },
          end: {
            line: 37,
            column: 49
          }
        }],
        line: 37
      },
      '3': {
        loc: {
          start: {
            line: 38,
            column: 17
          },
          end: {
            line: 38,
            column: 78
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 38,
            column: 17
          },
          end: {
            line: 38,
            column: 30
          }
        }, {
          start: {
            line: 38,
            column: 34
          },
          end: {
            line: 38,
            column: 69
          }
        }, {
          start: {
            line: 38,
            column: 73
          },
          end: {
            line: 38,
            column: 78
          }
        }],
        line: 38
      },
      '4': {
        loc: {
          start: {
            line: 42,
            column: 4
          },
          end: {
            line: 46,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 42,
            column: 4
          },
          end: {
            line: 46,
            column: 5
          }
        }, {
          start: {
            line: 42,
            column: 4
          },
          end: {
            line: 46,
            column: 5
          }
        }],
        line: 42
      },
      '5': {
        loc: {
          start: {
            line: 42,
            column: 8
          },
          end: {
            line: 42,
            column: 60
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 42,
            column: 8
          },
          end: {
            line: 42,
            column: 21
          }
        }, {
          start: {
            line: 42,
            column: 25
          },
          end: {
            line: 42,
            column: 60
          }
        }],
        line: 42
      },
      '6': {
        loc: {
          start: {
            line: 48,
            column: 4
          },
          end: {
            line: 51,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 48,
            column: 4
          },
          end: {
            line: 51,
            column: 5
          }
        }, {
          start: {
            line: 48,
            column: 4
          },
          end: {
            line: 51,
            column: 5
          }
        }],
        line: 48
      },
      '7': {
        loc: {
          start: {
            line: 54,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 54,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        }, {
          start: {
            line: 54,
            column: 4
          },
          end: {
            line: 59,
            column: 5
          }
        }],
        line: 54
      },
      '8': {
        loc: {
          start: {
            line: 57,
            column: 34
          },
          end: {
            line: 57,
            column: 44
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 57,
            column: 34
          },
          end: {
            line: 57,
            column: 38
          }
        }, {
          start: {
            line: 57,
            column: 42
          },
          end: {
            line: 57,
            column: 44
          }
        }],
        line: 57
      },
      '9': {
        loc: {
          start: {
            line: 91,
            column: 19
          },
          end: {
            line: 91,
            column: 31
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 91,
            column: 29
          },
          end: {
            line: 91,
            column: 31
          }
        }],
        line: 91
      },
      '10': {
        loc: {
          start: {
            line: 93,
            column: 14
          },
          end: {
            line: 93,
            column: 77
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 93,
            column: 15
          },
          end: {
            line: 93,
            column: 30
          }
        }, {
          start: {
            line: 93,
            column: 34
          },
          end: {
            line: 93,
            column: 57
          }
        }, {
          start: {
            line: 93,
            column: 62
          },
          end: {
            line: 93,
            column: 77
          }
        }],
        line: 93
      },
      '11': {
        loc: {
          start: {
            line: 101,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 101,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        }, {
          start: {
            line: 101,
            column: 4
          },
          end: {
            line: 104,
            column: 5
          }
        }],
        line: 101
      },
      '12': {
        loc: {
          start: {
            line: 101,
            column: 8
          },
          end: {
            line: 101,
            column: 40
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 101,
            column: 8
          },
          end: {
            line: 101,
            column: 11
          }
        }, {
          start: {
            line: 101,
            column: 15
          },
          end: {
            line: 101,
            column: 26
          }
        }, {
          start: {
            line: 101,
            column: 30
          },
          end: {
            line: 101,
            column: 40
          }
        }],
        line: 101
      },
      '13': {
        loc: {
          start: {
            line: 106,
            column: 4
          },
          end: {
            line: 108,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 106,
            column: 4
          },
          end: {
            line: 108,
            column: 5
          }
        }, {
          start: {
            line: 106,
            column: 4
          },
          end: {
            line: 108,
            column: 5
          }
        }],
        line: 106
      },
      '14': {
        loc: {
          start: {
            line: 106,
            column: 8
          },
          end: {
            line: 106,
            column: 26
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 106,
            column: 8
          },
          end: {
            line: 106,
            column: 11
          }
        }, {
          start: {
            line: 106,
            column: 15
          },
          end: {
            line: 106,
            column: 26
          }
        }],
        line: 106
      },
      '15': {
        loc: {
          start: {
            line: 112,
            column: 4
          },
          end: {
            line: 127,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 112,
            column: 4
          },
          end: {
            line: 127,
            column: 5
          }
        }, {
          start: {
            line: 112,
            column: 4
          },
          end: {
            line: 127,
            column: 5
          }
        }],
        line: 112
      },
      '16': {
        loc: {
          start: {
            line: 129,
            column: 14
          },
          end: {
            line: 129,
            column: 36
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 129,
            column: 14
          },
          end: {
            line: 129,
            column: 27
          }
        }, {
          start: {
            line: 129,
            column: 31
          },
          end: {
            line: 129,
            column: 36
          }
        }],
        line: 129
      },
      '17': {
        loc: {
          start: {
            line: 133,
            column: 4
          },
          end: {
            line: 135,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 133,
            column: 4
          },
          end: {
            line: 135,
            column: 5
          }
        }, {
          start: {
            line: 133,
            column: 4
          },
          end: {
            line: 135,
            column: 5
          }
        }],
        line: 133
      },
      '18': {
        loc: {
          start: {
            line: 137,
            column: 4
          },
          end: {
            line: 139,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 137,
            column: 4
          },
          end: {
            line: 139,
            column: 5
          }
        }, {
          start: {
            line: 137,
            column: 4
          },
          end: {
            line: 139,
            column: 5
          }
        }],
        line: 137
      },
      '19': {
        loc: {
          start: {
            line: 146,
            column: 4
          },
          end: {
            line: 148,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 146,
            column: 4
          },
          end: {
            line: 148,
            column: 5
          }
        }, {
          start: {
            line: 146,
            column: 4
          },
          end: {
            line: 148,
            column: 5
          }
        }],
        line: 146
      },
      '20': {
        loc: {
          start: {
            line: 184,
            column: 6
          },
          end: {
            line: 184,
            column: 54
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 184,
            column: 6
          },
          end: {
            line: 184,
            column: 17
          }
        }, {
          start: {
            line: 184,
            column: 21
          },
          end: {
            line: 184,
            column: 54
          }
        }],
        line: 184
      },
      '21': {
        loc: {
          start: {
            line: 212,
            column: 16
          },
          end: {
            line: 212,
            column: 53
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 212,
            column: 16
          },
          end: {
            line: 212,
            column: 28
          }
        }, {
          start: {
            line: 212,
            column: 32
          },
          end: {
            line: 212,
            column: 53
          }
        }],
        line: 212
      },
      '22': {
        loc: {
          start: {
            line: 213,
            column: 6
          },
          end: {
            line: 213,
            column: 25
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 213,
            column: 6
          },
          end: {
            line: 213,
            column: 25
          }
        }, {
          start: {
            line: 213,
            column: 6
          },
          end: {
            line: 213,
            column: 25
          }
        }],
        line: 213
      },
      '23': {
        loc: {
          start: {
            line: 220,
            column: 4
          },
          end: {
            line: 222,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 220,
            column: 4
          },
          end: {
            line: 222,
            column: 5
          }
        }, {
          start: {
            line: 220,
            column: 4
          },
          end: {
            line: 222,
            column: 5
          }
        }],
        line: 220
      },
      '24': {
        loc: {
          start: {
            line: 220,
            column: 8
          },
          end: {
            line: 220,
            column: 35
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 220,
            column: 8
          },
          end: {
            line: 220,
            column: 19
          }
        }, {
          start: {
            line: 220,
            column: 23
          },
          end: {
            line: 220,
            column: 35
          }
        }],
        line: 220
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0,
      '55': 0,
      '56': 0,
      '57': 0,
      '58': 0,
      '59': 0,
      '60': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0
    },
    b: {
      '0': [0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0],
      '10': [0, 0, 0],
      '11': [0, 0],
      '12': [0, 0, 0],
      '13': [0, 0],
      '14': [0, 0],
      '15': [0, 0],
      '16': [0, 0],
      '17': [0, 0],
      '18': [0, 0],
      '19': [0, 0],
      '20': [0, 0],
      '21': [0, 0],
      '22': [0, 0],
      '23': [0, 0],
      '24': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

var _opentracing = require('opentracing');

var _span = require('./span.js');

var _span2 = _interopRequireDefault(_span);

var _reporter = require('./reporter.js');

var _reporter2 = _interopRequireDefault(_reporter);

var _encoder = require('./encoder.js');

var _encoder2 = _interopRequireDefault(_encoder);

var _crypto = require('crypto');

var _textPropagator = require('./propagators/textPropagator');

var _textPropagator2 = _interopRequireDefault(_textPropagator);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const bth = (++cov_cnb1eitlw.s[0], []);
++cov_cnb1eitlw.s[1];
for (var i = 0; i < 256; ++i) {
  ++cov_cnb1eitlw.s[2];

  bth[i] = (i + 0x100).toString(16).substr(1);
}

function genId() {
  ++cov_cnb1eitlw.f[0];

  const buf = (++cov_cnb1eitlw.s[3], (0, _crypto.randomBytes)(8));
  let i = (++cov_cnb1eitlw.s[4], 0);
  ++cov_cnb1eitlw.s[5];
  return bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]];
}

/**
 * Tracer is the tracing entry-point.  It facilitates starting a new span and
 * context propagation (ie. inject, extract).
 */
class Tracer {
  /**
   * Construct a new tracer for internal use only.  Use {@link GlobalTracer#init} to set global trace options.
   *
   * @param {object} options - options used to initialize tracer
   * @param {bool} [options.multiEvent] - true for multi-event mode; otherwise, single-event mode
   * @param {bool} [options.debug] - true for debug; otherwise, it is disabled
   * @param {object.<string, Propagators>} [options.propagators] - optional propagators
   */
  constructor(options = (++cov_cnb1eitlw.b[0][0], {})) {
    ++cov_cnb1eitlw.f[1];
    ++cov_cnb1eitlw.s[6];

    this._reporter = (++cov_cnb1eitlw.b[1][0], options.reporter) || (++cov_cnb1eitlw.b[1][1], new _reporter2.default(_encoder2.default, options.stream));
    ++cov_cnb1eitlw.s[7];
    this.multiEvent = (++cov_cnb1eitlw.b[2][0], options.multiEvent) || (++cov_cnb1eitlw.b[2][1], false);
    ++cov_cnb1eitlw.s[8];
    this.debug = (++cov_cnb1eitlw.b[3][0], options.debug) || (++cov_cnb1eitlw.b[3][1], process.env.ctrace_debug === 'true') || (++cov_cnb1eitlw.b[3][2], false);
    ++cov_cnb1eitlw.s[9];
    this._propagation = {};
    ++cov_cnb1eitlw.s[10];
    this.logFn = options.logFn;

    ++cov_cnb1eitlw.s[11];
    if ((++cov_cnb1eitlw.b[5][0], options.logFn) && (++cov_cnb1eitlw.b[5][1], typeof options.logFn === 'function')) {
      ++cov_cnb1eitlw.b[4][0];
      ++cov_cnb1eitlw.s[12];

      options.logFn('options.debug: ' + options.debug);
      ++cov_cnb1eitlw.s[13];
      options.logFn('process.env.ctrace_debug: ' + process.env.ctrace_debug);
      ++cov_cnb1eitlw.s[14];
      options.logFn('this.debug: ' + this.debug);
    } else {
      ++cov_cnb1eitlw.b[4][1];
    }

    ++cov_cnb1eitlw.s[15];
    if (!options.replacePropagators) {
      ++cov_cnb1eitlw.b[6][0];
      ++cov_cnb1eitlw.s[16];

      this._propagation[_opentracing.FORMAT_HTTP_HEADERS] = [new _textPropagator2.default()];
      ++cov_cnb1eitlw.s[17];
      this._propagation[_opentracing.FORMAT_TEXT_MAP] = [new _textPropagator2.default()];
    } else {
      ++cov_cnb1eitlw.b[6][1];
    }

    const props = (++cov_cnb1eitlw.s[18], options.propagators);
    ++cov_cnb1eitlw.s[19];
    if (props) {
      ++cov_cnb1eitlw.b[7][0];
      ++cov_cnb1eitlw.s[20];

      for (let key of Object.keys(props)) {
        let list = (++cov_cnb1eitlw.s[21], this._propagation[key]);
        ++cov_cnb1eitlw.s[22];
        this._propagation[key] = ((++cov_cnb1eitlw.b[8][0], list) || (++cov_cnb1eitlw.b[8][1], [])).concat(props[key]);
      }
    } else {
      ++cov_cnb1eitlw.b[7][1];
    }
  }

  // ---------------------------------------------------------------------- //
  // OpenTracing API methods
  // ---------------------------------------------------------------------- //

  /**
   * Starts and returns a new Span representing a logical unit of work.
   *
   * For example:
   *
   *     // Start a new (parentless) root Span:
   *     let parent = tracer.startSpan('DoWork')
   *
   *     // Start a new (child) Span:
   *     let child = tracer.startSpan('Subroutine', {
   *         childOf: parent,
   *     });
   *
   * @param {string} name - the name of the operation.
   * @param {object} [options] - the fields to set on the newly created span.
   * @param {Span|SpanContext} [options.childOf] - a parent SpanContext (or Span,
   *        for convenience) that the newly-started span will be the child of
   *        (per REFERENCE_CHILD_OF). If specified, `fields.references` must
   *        be unspecified.
   * @param {object.<string, object>} [options.tags] - set of key-value pairs which will be set
   *        as tags on the newly created Span. Ownership of the object is
   *        passed to the created span for efficiency reasons (the caller
   *        should not modify this object after calling startSpan).
   * @return {Span} a new Span object.
   */
  startSpan(name, options = (++cov_cnb1eitlw.b[9][0], {})) {
    ++cov_cnb1eitlw.f[2];

    const now = (++cov_cnb1eitlw.s[23], Date.now() * 1000);
    let ref = (++cov_cnb1eitlw.s[24], (++cov_cnb1eitlw.b[10][0], options.childOf) && (++cov_cnb1eitlw.b[10][1], options.childOf._fields) || (++cov_cnb1eitlw.b[10][2], options.childOf));

    const spanId = (++cov_cnb1eitlw.s[25], genId());

    let traceId = (++cov_cnb1eitlw.s[26], spanId);
    let parentId;
    let baggage;

    ++cov_cnb1eitlw.s[27];
    if ((++cov_cnb1eitlw.b[12][0], ref) && (++cov_cnb1eitlw.b[12][1], ref.traceId) && (++cov_cnb1eitlw.b[12][2], ref.spanId)) {
      ++cov_cnb1eitlw.b[11][0];
      ++cov_cnb1eitlw.s[28];

      traceId = ref.traceId;
      ++cov_cnb1eitlw.s[29];
      parentId = ref.spanId;
    } else {
      ++cov_cnb1eitlw.b[11][1];
    }

    ++cov_cnb1eitlw.s[30];
    if ((++cov_cnb1eitlw.b[14][0], ref) && (++cov_cnb1eitlw.b[14][1], ref.baggage)) {
      ++cov_cnb1eitlw.b[13][0];
      ++cov_cnb1eitlw.s[31];

      baggage = ref.baggage;
    } else {
      ++cov_cnb1eitlw.b[13][1];
    }

    let f;

    ++cov_cnb1eitlw.s[32];
    if (parentId) {
      ++cov_cnb1eitlw.b[15][0];
      ++cov_cnb1eitlw.s[33];

      f = {
        traceId: traceId,
        spanId: spanId,
        parentId: parentId,
        operation: name,
        start: now
      };
    } else {
      ++cov_cnb1eitlw.b[15][1];
      ++cov_cnb1eitlw.s[34];

      f = {
        traceId: traceId,
        spanId: spanId,
        operation: name,
        start: now
      };
    }

    ++cov_cnb1eitlw.s[35];
    f.debug = (++cov_cnb1eitlw.b[16][0], options.debug) || (++cov_cnb1eitlw.b[16][1], false);
    ++cov_cnb1eitlw.s[36];
    f.operation = name;
    ++cov_cnb1eitlw.s[37];
    f.start = now;

    ++cov_cnb1eitlw.s[38];
    if (options.tags) {
      ++cov_cnb1eitlw.b[17][0];
      ++cov_cnb1eitlw.s[39];

      f.tags = options.tags;
    } else {
      ++cov_cnb1eitlw.b[17][1];
    }

    ++cov_cnb1eitlw.s[40];
    if (baggage) {
      ++cov_cnb1eitlw.b[18][0];
      ++cov_cnb1eitlw.s[41];

      f.baggage = baggage;
    } else {
      ++cov_cnb1eitlw.b[18][1];
    }

    ++cov_cnb1eitlw.s[42];
    f.logs = [{
      timestamp: now,
      event: 'Start-Span'
    }];

    ++cov_cnb1eitlw.s[43];
    if (this.multiEvent) {
      ++cov_cnb1eitlw.b[19][0];
      ++cov_cnb1eitlw.s[44];

      this._reporter.report(f);
    } else {
      ++cov_cnb1eitlw.b[19][1];
    }
    ++cov_cnb1eitlw.s[45];
    return new _span2.default(this, f);
  }

  /**
   * Injects the given SpanContext instance for cross-process propagation
   * within `carrier`. The expected type of `carrier` depends on the value of
   * `format.
   *
   * OpenTracing defines a common set of `format` values (see
   * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has
   * an expected carrier type.
   *
   * Consider this pseudocode example:
   *
   *     var clientSpan = ...;
   *     ...
   *     // Inject clientSpan into a text carrier.
   *     var headersCarrier = {};
   *     Tracer.inject(clientSpan.context(), Tracer.FORMAT_HTTP_HEADERS, headersCarrier);
   *     // Incorporate the textCarrier into the outbound HTTP request header
   *     // map.
   *     Object.assign(outboundHTTPReq.headers, headersCarrier);
   *     // ... send the httpReq
   *
   * @param  {SpanContext} spanContext - the SpanContext to inject into the
   *         carrier object. As a convenience, a Span instance may be passed
   *         in instead (in which case its .context() is used for the
   *         inject()).
   * @param  {string} format - the format of the carrier.
   * @param  {object} carrier - see the documentation for the chosen `format`
   *         for a description of the carrier object.
   */
  inject(spanContext, format, carrier) {
    ++cov_cnb1eitlw.f[3];

    const propagation = (++cov_cnb1eitlw.s[46], this._propagation[format]);
    ++cov_cnb1eitlw.s[47];
    for (let prop of propagation) {
      ++cov_cnb1eitlw.s[48];

      (++cov_cnb1eitlw.b[20][0], prop.inject) && (++cov_cnb1eitlw.b[20][1], prop.inject(spanContext, carrier));
    }
  }

  /**
   * Returns a SpanContext instance extracted from `carrier` in the given
   * `format`.
   *
   * OpenTracing defines a common set of `format` values (see
   * FORMAT_TEXT_MAP, FORMAT_HTTP_HEADERS, and FORMAT_BINARY), and each has
   * an expected carrier type.
   *
   * Consider this pseudocode example:
   *
   *     // Use the inbound HTTP request's headers as a text map carrier.
   *     var headersCarrier = inboundHTTPReq.headers;
   *     var wireCtx = Tracer.extract(Tracer.FORMAT_HTTP_HEADERS, headersCarrier);
   *     var serverSpan = Tracer.startSpan('...', { childOf : wireCtx });
   *
   * @param  {string} format - the format of the carrier.
   * @param  {object} carrier - the type of the carrier object is determined by
   *         the format.
   * @return {SpanContext} - The extracted SpanContext, or undefined if no such SpanContext could
   *         be found in `carrier`
   */
  extract(format, carrier) {
    ++cov_cnb1eitlw.f[4];

    const propagation = (++cov_cnb1eitlw.s[49], this._propagation[format]);
    ++cov_cnb1eitlw.s[50];
    for (let prop of propagation) {
      let ctx = (++cov_cnb1eitlw.s[51], (++cov_cnb1eitlw.b[21][0], prop.extract) && (++cov_cnb1eitlw.b[21][1], prop.extract(carrier)));
      ++cov_cnb1eitlw.s[52];
      if (ctx) {
          ++cov_cnb1eitlw.b[22][0];
          ++cov_cnb1eitlw.s[53];
          return ctx;
        } else {
        ++cov_cnb1eitlw.b[22][1];
      }
    }
    ++cov_cnb1eitlw.s[54];
    return undefined;
  }

  report(fields) {
    ++cov_cnb1eitlw.f[5];
    ++cov_cnb1eitlw.s[55];

    // if tracer.debug is false and span.debug is true, don't log this event
    if ((++cov_cnb1eitlw.b[24][0], !this.debug) && (++cov_cnb1eitlw.b[24][1], fields.debug)) {
      ++cov_cnb1eitlw.b[23][0];
      ++cov_cnb1eitlw.s[56];

      return;
    } else {
      ++cov_cnb1eitlw.b[23][1];
    }
    ++cov_cnb1eitlw.s[57];
    return this._reporter.report(fields);
  }

  static genId() {
    ++cov_cnb1eitlw.f[6];

    const buf = (++cov_cnb1eitlw.s[58], (0, _crypto.randomBytes)(8));
    let i = (++cov_cnb1eitlw.s[59], 0);
    ++cov_cnb1eitlw.s[60];
    return bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]];
  }
}
exports.default = Tracer;
module.exports = exports['default'];